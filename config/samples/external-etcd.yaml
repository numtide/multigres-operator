apiVersion: multigres.com/v1alpha1
kind: MultigresCluster
metadata:
  name: external-etcd-cluster
  namespace: default
spec:
  # ----------------------------------------------------------------
  # 1. Global Topology (External)
  # ----------------------------------------------------------------
  # Connects to an existing, external Etcd cluster (e.g. cloud managed).
  globalTopoServer:
    external:
      endpoints:
        - "https://etcd-1.infra.local:2379"
        - "https://etcd-2.infra.local:2379"
      caSecret: "etcd-ca-secret"
      clientCertSecret: "etcd-client-cert-secret"
      rootPath: "/multigres/global"

  # ----------------------------------------------------------------
  # 2. Cell Definitions (Mixed Mode)
  # ----------------------------------------------------------------
  cells:
    # Cell A: Standard Configuration
    # Uses the Global External Etcd defined above.
    - name: "zone-a"
      zone: "us-east-1a"

    # Cell B: High-Isolation Configuration
    # This cell has its own dedicated, Operator-managed Etcd cluster.
    # It does NOT use the global etcd for cell-level data.
    # Benefit: If the external global etcd has an outage, this cell
    # remains fully functional for intra-cell traffic.
    - name: "zone-b-isolated"
      zone: "us-east-1b"
      spec:
        localTopoServer:
          etcd:
            image: "quay.io/coreos/etcd:v3.5"
            replicas: 3
            storage:
              size: "5Gi"
              class: "standard-gp3"
        # Since we are defining 'spec', we must also define the gateway
        multigateway:
           replicas: 2
