# Patch the operator Deployment to inject OTEL environment variables.
# This activates:
#   1. InitTracing() in main.go — starts exporting traces to Tempo
#   2. BuildOTELEnvVars() fallback — data-plane containers inherit the config
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
spec:
  template:
    spec:
      containers:
        - name: manager
          env:
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: "http://otel-collector.multigres-operator.svc:4318"
            - name: OTEL_EXPORTER_OTLP_PROTOCOL
              value: "http/protobuf"
            - name: OTEL_TRACES_EXPORTER
              value: "otlp"
            - name: OTEL_METRICS_EXPORTER
              value: "otlp"
            - name: OTEL_TRACES_SAMPLER
              value: "always_on"
