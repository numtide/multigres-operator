apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-multigres
  labels:
    grafana_dashboard: "1"
    app.kubernetes.io/name: multigres-operator
    app.kubernetes.io/component: monitoring
data:
  operator-overview.json: |
    {"annotations":{"list":[]},"description":"Operational health of the multigres-operator controller manager","editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"links":[],"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"title":"Reconciliation","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"ops/s","drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"ops"},"overrides":[{"matcher":{"id":"byRegexp","options":".*error.*"},"properties":[{"id":"color","value":{"fixedColor":"red","mode":"fixed"}}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":1},"id":1,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Reconcile Rate by Controller","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"sum by (controller, result) (rate(controller_runtime_reconcile_total[5m]))","legendFormat":"{{controller}} / {{result}}"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"errors/s","drawStyle":"line","fillOpacity":25,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"normal"},"thresholdsStyle":{"mode":"line"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0.01}]},"unit":"ops"}},"gridPos":{"h":8,"w":12,"x":12,"y":1},"id":2,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Reconcile Errors by Controller","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"sum by (controller) (rate(controller_runtime_reconcile_errors_total[5m]))","legendFormat":"{{controller}}"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"seconds","drawStyle":"line","fillOpacity":10,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"},"thresholdsStyle":{"mode":"line"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":10},{"color":"red","value":30}]},"unit":"s"}},"gridPos":{"h":8,"w":12,"x":0,"y":9},"id":3,"options":{"legend":{"calcs":["mean","max","lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Reconcile Duration (p50 / p99)","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"histogram_quantile(0.50, sum by (controller, le) (rate(controller_runtime_reconcile_time_seconds_bucket[5m])))","legendFormat":"{{controller}} p50"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"histogram_quantile(0.99, sum by (controller, le) (rate(controller_runtime_reconcile_time_seconds_bucket[5m])))","legendFormat":"{{controller}} p99"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"items","drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"},"thresholdsStyle":{"mode":"line"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":20},{"color":"red","value":50}]},"unit":"short"}},"gridPos":{"h":8,"w":12,"x":12,"y":9},"id":4,"options":{"legend":{"calcs":["mean","max","lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Work Queue Depth","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"workqueue_depth","legendFormat":"{{name}}"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":17},"id":101,"title":"Webhooks","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"req/s","drawStyle":"bars","fillOpacity":60,"gradientMode":"opacity","lineWidth":1,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"normal"}},"unit":"reqps"},"overrides":[{"matcher":{"id":"byRegexp","options":".*error.*"},"properties":[{"id":"color","value":{"fixedColor":"red","mode":"fixed"}}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":18},"id":5,"options":{"legend":{"calcs":["sum"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Webhook Request Rate","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"sum by (operation, result) (rate(multigres_operator_webhook_request_total[5m]))","legendFormat":"{{operation}} / {{result}}"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisLabel":"seconds","drawStyle":"line","fillOpacity":10,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"s"}},"gridPos":{"h":8,"w":12,"x":12,"y":18},"id":6,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Webhook Latency (p50 / p99)","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"histogram_quantile(0.50, sum by (operation, le) (rate(multigres_operator_webhook_request_duration_seconds_bucket[5m])))","legendFormat":"{{operation}} p50"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"histogram_quantile(0.99, sum by (operation, le) (rate(multigres_operator_webhook_request_duration_seconds_bucket[5m])))","legendFormat":"{{operation}} p99"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":26},"id":102,"title":"Go Runtime","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"}},"gridPos":{"h":8,"w":8,"x":0,"y":27},"id":7,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"single"}},"title":"Goroutines","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"go_goroutines{job=~\".*multigres.*\"}","legendFormat":"goroutines"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"bytes"}},"gridPos":{"h":8,"w":8,"x":8,"y":27},"id":8,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Memory","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"process_resident_memory_bytes{job=~\".*multigres.*\"}","legendFormat":"RSS"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"go_memstats_heap_alloc_bytes{job=~\".*multigres.*\"}","legendFormat":"Heap Alloc"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"s"}},"gridPos":{"h":8,"w":8,"x":16,"y":27},"id":9,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"single"}},"title":"GC Pause Duration","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"rate(go_gc_duration_seconds_sum{job=~\".*multigres.*\"}[5m])","legendFormat":"GC time/s"}]}],"schemaVersion":39,"tags":["multigres","operator","kubernetes"],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Multigres Operator Overview","uid":"multigres-operator-overview","version":1}
  cluster-health.json: |
    {"annotations":{"list":[]},"description":"MultigresCluster topology health: cluster phase, cell gateways, shard pools, and TopoServer","editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"links":[],"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"title":"Cluster Overview","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"fixed","fixedColor":"text"},"custom":{"align":"center","cellOptions":{"type":"color-text"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[{"matcher":{"id":"byName","options":"phase"},"properties":[{"id":"mappings","value":[{"type":"value","options":{"Healthy":{"color":"green","text":"Healthy"},"Provisioning":{"color":"yellow","text":"Provisioning"},"Degraded":{"color":"orange","text":"Degraded"},"Error":{"color":"red","text":"Error"}}}]},{"id":"custom.cellOptions","value":{"type":"color-text"}}]},{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"custom.hidden","value":true}]}]},"gridPos":{"h":6,"w":24,"x":0,"y":1},"id":1,"options":{"showHeader":true,"sortBy":[{"displayName":"name"}]},"title":"Cluster Phases","type":"table","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_cluster_info == 1","format":"table","instant":true}],"transformations":[{"id":"filterFieldsByName","options":{"include":{"names":["name","namespace","phase"]}}}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"}},"gridPos":{"h":8,"w":12,"x":0,"y":7},"id":2,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Cells per Cluster","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_cluster_cells_total","legendFormat":"{{cluster}} ({{namespace}})"}]},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"}},"gridPos":{"h":8,"w":12,"x":12,"y":7},"id":3,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Shards per Cluster","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_cluster_shards_total","legendFormat":"{{cluster}} ({{namespace}})"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":15},"id":101,"title":"Cell Gateways","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"},"overrides":[{"matcher":{"id":"byRegexp","options":".*desired.*"},"properties":[{"id":"custom.lineStyle","value":{"fill":"dash","dash":[10,10]}}]}]},"gridPos":{"h":8,"w":24,"x":0,"y":16},"id":4,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"MultiGateway Replicas (Desired vs Ready)","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_cell_gateway_replicas{state=\"desired\"}","legendFormat":"{{cell}} desired"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_cell_gateway_replicas{state=\"ready\"}","legendFormat":"{{cell}} ready"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":24},"id":102,"title":"Shard Pools","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"},"overrides":[{"matcher":{"id":"byRegexp","options":".*desired.*"},"properties":[{"id":"custom.lineStyle","value":{"fill":"dash","dash":[10,10]}}]}]},"gridPos":{"h":8,"w":24,"x":0,"y":25},"id":5,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Pool Replicas (Desired vs Ready)","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_shard_pool_replicas{state=\"desired\"}","legendFormat":"{{shard}}/{{pool}} desired"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_shard_pool_replicas{state=\"ready\"}","legendFormat":"{{shard}}/{{pool}} ready"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":33},"id":103,"title":"TopoServer","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"drawStyle":"line","fillOpacity":15,"gradientMode":"opacity","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"mode":"none"}},"unit":"short"},"overrides":[{"matcher":{"id":"byRegexp","options":".*desired.*"},"properties":[{"id":"custom.lineStyle","value":{"fill":"dash","dash":[10,10]}}]}]},"gridPos":{"h":8,"w":24,"x":0,"y":34},"id":6,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"bottom"},"tooltip":{"mode":"multi","sort":"desc"}},"title":"TopoServer Replicas (Desired vs Ready)","type":"timeseries","targets":[{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_toposerver_replicas{state=\"desired\"}","legendFormat":"{{name}} desired"},{"datasource":{"type":"prometheus","uid":"prometheus-uid"},"expr":"multigres_operator_toposerver_replicas{state=\"ready\"}","legendFormat":"{{name}} ready"}]}],"schemaVersion":39,"tags":["multigres","cluster","kubernetes"],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Multigres Cluster Health","uid":"multigres-cluster-health","version":1}
